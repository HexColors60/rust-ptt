# ANSI 跳脫代碼 (ANSI Escape Code)

ANSI 跳脫代碼是一種用來控制文字終端機上的色彩、格式等各種顯示方式的一種方法。每一段跳脫代碼由多個字元組成。其中都以 `ESC` (ASCII 十進位為 `27`、十六進位為 `0x1B`) 字元為開頭。第二個字元之後則為 ASCII `64` 到 `95` 之間的任一字元。

代碼可以再以第二個字元是否為 `[` (ASCII 十進位為 `91`、十六進位為 `0x5B`) 來進行分類。第二個字元為 `[` 的代碼稱為 CSI (Control Sequence Introducer) 代碼，為其它字元者則稱為 Non-CSI 代碼。

以上都假設環境為 7-bit，也就是每個字元只能用 0 ~ 127 的數字表示。若在 8-bit 環境之下，每個字元可以有 256 種表示方式。某兩個跳脫代碼的字元可以被代換為 `0x80` 到 `0x9F` 的某個字元。不過 7-bit 仍比較常用，而且 PTT 似乎只支援 7-bit 環境。


## Non-CSI

Non-CSI 指的是開頭不是 `ESC` + `[` 的跳脫代碼。

常見的 Non-CSI 代碼如下：

注意下面代碼中的空白只是用來區別字元，實際上的代碼並不包含空白。

- `ESC N`
- `ESC O`
- `ESC P`
- `ESC \`
- `ESC ]`
- `ESC X`
- `ESC ^`
- `ESC _`
- `ESC c`

## CSI

CSI 指的是開頭為 `ESC` + `[` 的跳脫代碼。CSI 的格式為 `ESC` + `[` + 參數字串 + 一個結尾字元。

### 參數字串

參數字串由多個 ASCII `0x30` (`0`) 到 `0x3F` (`?`) 的字元所組成。通常這個字串會是一坨由 `;` 分開的數字，非數字則常作為 flag 使用。

### 結尾字元

結尾字元是 ASCII `0x40` (`@`) 到 `0x7E` (`~`) 的其中一個字，用來表示這組 CSI 跳脫代碼所代表的動作。

### 常見動作

注意下面代碼中的空白只是用來區別字元，實際上的代碼並不包含空白。

- `ESC [ (參數) A`
- `ESC [ (參數) B`
- `ESC [ (參數) C`
- `ESC [ (參數) D`
- `ESC [ (參數) E`
- `ESC [ (參數) F`
- `ESC [ (參數) G`
- `ESC [ (參數1); (參數2) H`
- `ESC [ (參數) J`
- `ESC [ (參數) K`
- `ESC [ (參數) S`
- `ESC [ (參數) T`
- `ESC [ (參數1); (參數2) f`
- `ESC [ (參數) m`
- `ESC [ 5 i`
- `ESC [ 4 i`
- `ESC [ 6 n`
- `ESC [ s`
- `ESC [ u`
- `ESC [ ?25l`
  - 注意結尾是小寫的 L
- `ESC [ ?25h`

## 參考資料

[Wiki - ANSI Escape Code](https://en.wikipedia.org/wiki/ANSI_escape_code)
